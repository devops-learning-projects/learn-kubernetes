# A Deployment manages a set of Pods to run an application workload, usually one that doesn't maintain state.
# A Deployment provides declarative updates for Pods and ReplicaSets.
# deployment in maintain by deployment controller

#apiVersion: apps/v1
#kind: Deployment
#metadata:
#  name: rs-demo
#  labels:
#    project: example
#    app: nginx
#spec:
#  replicas: 3
#  selector:
#    matchLabels:
#      app: nginx
#  template:
#    metadata:
#      labels:
#        app: nginx
#    spec:
#      containers:
#        - name: nginx
#          image: nginx:1.26

# we can also update deployment from the cli
# $ kubectl set image deployment/rs-demo nginx=nginx:1.16.1

## The rollout gets stuck. You can verify it by checking the rollout status:
# kubectl rollout status deployment/rs-demo --> to roll out the previous version
# kubectl rollout history deployment/rs-demo --> to set rollout history

#To see the details of each revision, run:
# kubectl rollout history deployment/rs-demo  --revision=2
##
# kubectl rollout undo deployment/rs-demo

## replicaset with Proportional scaling
#  Proportional scaling in Kubernetes, particularly in the context of Deployments with a RollingUpdate strategy, refers to how additional replicas are distributed among existing ReplicaSets during a scaling event (either up or down) while a rollout is in progress or paused. This behavior aims to mitigate risk by ensuring a balanced distribution of replicas across different versions of an application.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: rs-demo
  labels:
    project: example
    app: nginx
spec:
  replicas: 3
  minReadySeconds: 15   # <-- move it here
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          image: nginx:1.25
